{% extends 'base.html' %}

{% block content %}
    <h1>Список Издательств</h1>

    <!-- Форма поиска -->
    <form action="{{ url_for('publishing_houses.get_publishing_houses') }}" method="get">
        <input type="text" name="search" placeholder="Поиск по названию..." value="{{ search_query }}">
        <button type="submit">Поиск</button>
    </form>

    <!-- Таблица с издательствами -->
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Название</th>
                <th>Контактная информация</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for publishing_house in pagination.items %}
                <tr>
                    <td>{{ publishing_house.publishing_house_id }}</td>
                    <td>{{ publishing_house.publishing_house_name }}</td>
                    <td>{{ publishing_house.contact_information }}</td>
                    <td>
                        <a href="{{ url_for('publishing_houses.edit_publishing_house', house_id=publishing_house.publishing_house_id) }}">Изменить</a>

                        <!-- Форма для безопасного удаления с использованием POST-запроса -->
                        <form action="{{ url_for('publishing_houses.delete_publishing_house', house_id=publishing_house.publishing_house_id) }}" method="post" style="display:inline;">
                            <button type="submit" onclick="return confirm('Удалить это издательство?');">Удалить</button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Пагинация -->
    <div>
        {% if pagination.pages > 1 %}
            <ul style="list-style-type: none; display: flex; gap: 10px;">
                {% if pagination.has_prev %}
                    <li><a href="{{ url_for('publishing_houses.get_publishing_houses', page=pagination.prev_num, search=search_query) }}">Назад</a></li>
                {% endif %}

                {# Показ номера страницы с ссылками на конкретные страницы #}
                {% for page_num in pagination.iter_pages(left_edge=2, right_edge=2, left_current=2, right_current=2) %}
                    {% if page_num %}
                        {% if page_num == pagination.page %}
                            <li><strong>{{ page_num }}</strong></li>
                        {% else %}
                            <li><a href="{{ url_for('publishing_houses.get_publishing_houses', page=page_num, search=search_query) }}">{{ page_num }}</a></li>
                        {% endif %}
                    {% else %}
                        <li>…</li>
                    {% endif %}
                {% endfor %}

                {% if pagination.has_next %}
                    <li><a href="{{ url_for('publishing_houses.get_publishing_houses', page=pagination.next_num, search=search_query) }}">Вперед</a></li>
                {% endif %}
            </ul>
        {% endif %}
    </div>

    <!-- Кнопка для добавления нового издательства -->
    <a href="{{ url_for('publishing_houses.new_publishing_house') }}">Добавить новое издательство</a>
{% endblock %}
